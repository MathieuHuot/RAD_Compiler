\begin{figure*}[t]
    \begin{tabular}{r c l}
        $\directD{\rho}{\Gamma}{Y}$(!A!) &=& !A $\times$ ($\Gamma$ $\times$ A->$\rho$)!\\
    \end{tabular}
    \medskip

    \begin{tabular}{r c l}
        $\directD{\rho}{\Gamma}{Y}$(!c!) &=& 
            !<c, fun (x$_{1}$,$\ldots$,x$_n$,z) ->! \\
            && !Y(x$_{1}$,$\ldots$,x$_{n}$) >!\\
        $\directD{\rho}{\Gamma}{Y}$(!x!) &=& 
            !<x, fun (x$_{1}$,$\ldots$,x$_n$,z) ->! \\
            && !Y((x$_{1}$,$\ldots$,x$_n$)!$\widehat{+}$![pos(x)]z) >!\\
        $\directD{\rho}{\Gamma}{Y}$!let x:A = e$_{1}$ in e$_{2}$!) &=& 
            !let x,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e$_{1}$) in! \\
            &&!let y,Y$_{2}$ = !$\directD{\rho}{\Gamma,x:A}{Y_1}$!(e$_{2}$) in!\\ 
            &&!<y, fun (x$_{1}$,$\ldots$,x$_n$,z) -> Y$_{2}$(x$_{1}$,$\ldots$,x$_n$,!$0_{A}$!,z)>!\\
        $\directD{\rho}{\Gamma}{Y}$(!< e$_{1}$, e$_{2}$ >!) &=&
            !let y$_{1}$,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e$_{1}$) in! \\
            &&!let y$_{2}$,Y$_{2}$ = !$\directD{\rho}{\Gamma,x_1}{Y_1}$!(e$_{2}$) in!\\
            &&!< <y$_{1}$,y$_{2}$>, fun (x$_{1}$,$\ldots$,x$_n$,z) -> !\\
            &&!Y(x$_{1}$,$\ldots$,x$_n$,!$\pi_1$!(z),!$\pi_2$!(z)) >!\\ 
        $\directD{\rho}{\Gamma}{Y}$($\pi_1$(!e!:AxB)) &=&
            !let x,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e) in! \\
            && !<!$\pi_1$!x, fun (x$_{1}$,$\ldots$,x$_n$,z) -> Y(x$_{1}$,$\ldots$,x$_n$,(z,!$0_B$!))>! \\
        $\directD{\rho}{\Gamma}{Y}$($\pi_2$(!e!:AxB)) &=&
            !let x,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e) in! \\
            && !<!$\pi_2$!x, fun (x$_{1}$,$\ldots$,x$_n$,z) -> Y(x$_{1}$,$\ldots$,x$_n$,(!$0_A$,z!))>! \\
        $\directD{\rho}{\Gamma}{Y}$(!op1 e!) &=&  
            !let x,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e) in! \\
            && !<op1 x, fun (x$_{1}$,$\ldots$,x$_n$,z) -> ! \\
            && !Y(x$_{1}$,$\ldots$,x$_n$,!$\partial$!op1(x)*z) >! \\
        $\directD{\rho}{\Gamma}{Y}$(!e$_{1}$ op2 e$_{2}$!) &=& 
            !let x$_{1}$,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e$_{1}$) in! \\
            && !let x$_{2}$,Y$_{2}$ = !$\directD{\rho}{\Gamma,x_1}{Y_1}$!(e$_{2}$) in! \\
            && !<x$_{1}$ op2 x$_{2}$, fun (x$_{1}$,$\ldots$,x$_n$,z) ->! \\
            && !Y$_{2}$(x$_{1}$,$\ldots$,x$_n$,!$\partial_1$!op2(x$_{1}$,x$_{2}$)*z,!$\partial_2$!op2(x$_{1}$,x$_{2}$)*z>! \\
        $\directD{\rho}{\Gamma}{Y}$(!map2 (x,y.e$_{1}$) e$_{2}$ e$_{3}$!) &=&  
            !let A,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e$_{2}$) in! \\
            && !let B,Y$_{2}$ = !$\directD{\rho}{\Gamma,A}{Y_1}$!(e$_{3}$) in! \\
            && !let G=!$\grad_{\Gamma}$!e$_{1}$ in!\\
            && !<map2 (x,y.e$_{1}$) A B, fun (x$_{1}$,$\ldots$,x$_n$,Z) -> !\\
            && !Y$_{2}$( (x$_{1}$,$\ldots$,x$_n$)!$\widehat{+}$!(G*(reduce + 0 Z)),!\\
            && \quad\quad! map2 (a,b.(!$\grad_{\{x\}}$!e$_{1}$)[a/x]*b) A Z,!\\
            && \quad\quad! map2 (a,b.(!$\grad_{\{y\}}$!e$_{1}$)[a/x]*b) B Z )>!\\
        $\directD{\rho}{\Gamma}{Y}$(!reduce (x,y.e$_{1}$) e$_{2}$ e$_{3}$!) &=&
            !let y$_{1}$,Y$_{1}$ = !$\directD{\rho}{\Gamma}{Y}$!(e$_{2}$) in! \\
            && !let A,Y$_{2}$ = !$\directD{\rho}{\Gamma,y_1}{Y_1}$!(e$_{3}$) in! \\
            && !let A$_{0}$ = shift1R (scanl (x,y.e$_{1}$) y$_{1}$ A) in! \\
            && !let A$_{1}$ = shift1L (map2 (a,b.(!$\grad_{\{x\}}$!e$_{1}$)[a/x,b/y]) A$_{0}$ A) in! \\
            && !let A$_{2}$ = map2 (a,b.(!$\grad_{\{y\}}$!)e$_{1}$[a/x,b/y]) A$_{0}$ A in! \\
            && !let A$_{3}$ = scanr * 1 A$_{1}$ in! \\
            && !<reduce (x,y.e$_{1}$) y$_{1}$ A, fun (x$_{1}$,$\ldots$,x$_n$,z) ->! \\
            && !Y$_{2}$(x$_{1}$,$\ldots$,x$_n$, map2 (x,y. x*y*z) A$_{2}$ A$_{3}$)>! \\
        \end{tabular}
    \caption{Reverse-mode transformation from source to target language}
    \label{fig:direct_diff_macro}    
\end{figure*}